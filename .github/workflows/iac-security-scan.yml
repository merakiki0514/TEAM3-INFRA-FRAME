name: IaC Security Scan (Gemini 2.5)

# 1. ì–¸ì œ ì´ ë¡œë´‡ì„ ì‹¤í–‰í•  ê²ƒì¸ê°€? (Trigger)
on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  analyze-iac:
    # 2. ì–´ë–¤ í™˜ê²½(OS)ì—ì„œ ì‹¤í–‰í•  ê²ƒì¸ê°€?
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ 1. ë‚´ ì½”ë“œ ê°€ì ¸ì˜¤ê¸° (Checkout)
      uses: actions/checkout@v4

    - name: ğŸ 2. íŒŒì´ì¬ í™˜ê²½ ì„¸íŒ…
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    - name: ğŸ“¦ 3. í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install google-genai

    - name: ğŸ” 4. Gemini ë³´ì•ˆ ë¶„ì„ê¸° ì‹¤í–‰!
      # ë°©ê¸ˆ ì•ˆì „í•˜ê²Œ ìˆ¨ê²¨ë‘” GitHub Secretì—ì„œ API í‚¤ë¥¼ êº¼ë‚´ì™€ì„œ í™˜ê²½ë³€ìˆ˜ì— ì£¼ì…í•©ë‹ˆë‹¤.
      env:
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      run: |
        cd infra/Analyzer
        python3 S3_Analyzer.py
        cat S3_security_report.txt